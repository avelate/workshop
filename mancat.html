<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mancat, Detective Cat</title>
    <!-- Font Awesome for the cat icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Google Fonts for the monospace font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    
    <!-- Embedded CSS for styling the game -->
    <style>
        :root {
            --primary-color: #f7f7f7;
            --secondary-color: #333333;
            --accent-color: #b82d00;
            --background-color: #1a1a1a;
            --text-color: #f7f7f7;
            --button-hover-color: #d63d00;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }

        .game-container {
            width: 90%;
            max-width: 600px;
            padding: 2rem;
            background-color: var(--secondary-color);
            border: 2px solid var(--accent-color);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            margin: 1rem;
            position: relative;
        }
        
        h1 {
            color: var(--accent-color);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .cat-icon {
          font-size: 2.5rem;
          color: var(--accent-color);
          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }

        #story-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            min-height: 150px;
            text-align: left;
        }

        #choices-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .choice-button, .action-button, .notebook-button {
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border: none;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
            font-family: 'Roboto Mono', monospace;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .notebook-button {
            background-color: #6a6a6a;
            color: #f7f7f7;
            padding: 0.75rem 1rem;
            margin-top: 1rem;
        }
        
        .notebook-button:hover {
            background-color: #888888;
        }

        .choice-button:hover, .action-button:hover:not(:disabled) {
            background-color: var(--button-hover-color);
            color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.5);
        }

        .action-button-group {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .action-button-group button {
            flex: 1;
            padding: 0.75rem;
        }
        
        #inventory {
            margin-top: 1.5rem;
            text-align: left;
            font-size: 0.9rem;
            border-top: 1px solid var(--primary-color);
            padding-top: 1rem;
        }
        
        .fade-in {
            opacity: 0;
            animation: fadeIn 1s forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Notebook Modal Styles */
        .notebook-modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
        }
        
        .notebook-content {
            background-color: var(--secondary-color);
            margin: 15% auto;
            padding: 20px;
            border: 2px solid var(--accent-color);
            width: 80%;
            max-width: 500px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .close-button {
            color: var(--primary-color);
            align-self: flex-end;
            font-size: 28px;
            font-weight: bold;
        }
        
        .close-button:hover,
        .close-button:focus {
            color: var(--accent-color);
            text-decoration: none;
            cursor: pointer;
        }
        
        #notebook-textarea {
            width: 100%;
            min-height: 300px;
            background-color: #1a1a1a;
            color: #e0e0e0;
            border: 1px solid #555;
            padding: 10px;
            font-family: 'Roboto Mono', monospace;
            font-size: 1rem;
            resize: vertical;
            border-radius: 8px;
        }

        /* Dialogue Bubble Styles */
        #dialogue-bubble {
            position: relative;
            background-color: var(--primary-color);
            color: var(--secondary-color);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            min-height: 150px;
            text-align: left;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            display: none; /* Hidden by default */
            flex-direction: column;
            justify-content: center;
        }
        
        .speaker-name {
            font-weight: bold;
            color: var(--accent-color);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .dialogue-text {
            font-size: 1.1rem;
            line-height: 1.6;
        }

    </style>
</head>
<body>
    <div class="game-container">
        <h1><i class="fas fa-cat cat-icon"></i> Detective Mancat</h1>
        
        <!-- Story text and Dialogue bubble containers -->
        <div id="story-text" class="fade-in">
            <!-- Story text will be injected here -->
        </div>
        <div id="dialogue-bubble">
            <p class="speaker-name" id="speaker-name"></p>
            <p class="dialogue-text" id="dialogue-text"></p>
        </div>
        
        <div id="choices-container">
            <!-- Choice buttons will be injected here -->
        </div>
        
        <div class="action-button-group">
            <button id="save-button" class="action-button">Save Game</button>
            <button id="load-button" class="action-button">Load Game</button>
        </div>
        
        <button id="notebook-toggle" class="notebook-button"><i class="fas fa-book"></i> Open Notebook</button>

        <div id="inventory">
            <p><strong>Inventory:</strong> <span id="inventory-list"></span></p>
        </div>
    </div>
    
    <!-- The Notebook Modal -->
    <div id="notebook-modal" class="notebook-modal">
        <div class="notebook-content">
            <span class="close-button">&times;</span>
            <h2>Notes</h2>
            <textarea id="notebook-textarea" placeholder="Write your clues and thoughts here..."></textarea>
        </div>
    </div>

    <!-- The game logic is all contained here -->
    <script>
        // --- Game Logic ---
        
        // Game story data, a map of scenes with text, choices, and logic
        const gameData = {
            start: {
                text: "The rain beats a steady rhythm against my office window, a tune I know well. The city of Meow York is sleeping, but trouble never rests. I'm Detective Mancat, and my latest case just scratched at the door. A dame with a silk scarf and a whole lotta cash. Her name? Penelope Fluffington. Said her prize-winning dog, a poodle named 'Fifi', is missing. Sounds like a classic snatch and run to me. But there's always more to the story. I grab my trench coat and head out.",
                choices: [
                    { text: "Head to Penelope's mansion", nextScene: 'mansion_front' }
                ]
            },
            mansion_front: {
                text: "Penelope Fluffington's mansion is a gaudy display of wealth and bad taste. The air is thick with the scent of wet dog and expensive perfume. The butler, a tall, nervous Dalmatian named Winston, greets me at the door. 'She's been waiting for you, sir,' he says, wringing his paws. He seems too anxious, even for a butler with a missing dog on his hands.",
                choices: [
                    { text: "Question the butler", nextScene: 'question_butler' },
                    { text: "Demand to see the last place Fifi was seen", nextScene: 'investigate_parlor' }
                ]
            },
            question_butler: {
                speaker: "Winston",
                text: "'What can you tell me about the disappearance, Winston? Don't leave out any details.' The Dalmatian sweats, pulling at his collar. 'I... I heard a strange scratching noise from the master study last night, just before Fifi went missing. It sounded like... claws on wood.' He looks around, as if afraid of being heard.",
                choices: [
                    { text: "Thank him and head to the study", nextScene: 'study' },
                    { text: "Go back and check the parlor anyway", nextScene: 'investigate_parlor' }
                ],
                onEnter: (gameState) => {
                    gameState.clues.scratch_noise = true;
                }
            },
            investigate_parlor: {
                text: "I bypass the nervous butler and head straight to the parlor. The scene of the crime. This is where Fifi was last seen. I need to search the room for any clues or hidden items.",
                choices: [
                    { text: "Look under the plush velvet couch", nextScene: 'found_dog_toy' },
                    { text: "Inspect the grand piano", nextScene: 'found_thimble' },
                    { text: "Head to the study, following the butler's tip", nextScene: 'study' }
                ]
            },
            found_dog_toy: {
                text: "Under the couch, I spot something. A piece of a dog toy, ripped in half. It's a squeaky tennis ball, but the rubber is of a unique, high-end brand: 'Golden Bones.' I slip it into my inventory. This could be a solid lead.",
                choices: [
                    { text: "Go back to the parlor", nextScene: 'investigate_parlor' }
                ],
                onEnter: (gameState) => {
                    const newItem = 'Torn Dog Toy (Golden Bones brand)';
                    if (!gameState.inventory.includes(newItem)) {
                        gameState.inventory.push(newItem);
                    }
                }
            },
            found_thimble: {
                text: "Behind the grand piano, I find a tiny, shiny metal thimble. It's engraved with the initials 'P.F.'. This is odd, but worth keeping. I place it in my inventory.",
                choices: [
                    { text: "Go back to the parlor", nextScene: 'investigate_parlor' }
                ],
                onEnter: (gameState) => {
                    const newItem = 'Shiny Thimble (P.F. initials)';
                    if (!gameState.inventory.includes(newItem)) {
                        gameState.inventory.push(newItem);
                    }
                }
            },
            study: {
                text: "The study is a mess, books are thrown everywhere. The scratching noise Winston mentioned must've been loud. I run a paw over the bookcase and find a loose panel. Behind it, a small opening, the entrance to a dark tunnel. This isn't just a simple kidnapping. This is a setup.",
                choices: [
                    { text: "Enter the dark tunnel", nextScene: 'tunnel_enter' }
                ]
            },
            dog_toy_clue: {
                text: "I decide to follow the clue from the toy. I know a place that sells that brand. It's a posh dog boutique, 'Poodle Palace,' downtown. I walk in and flash my badge (a tiny cat-shaped one). I ask the owner, a snooty Shih Tzu, about the 'Golden Bones' brand. He tells me they're exclusively sold to the elite, and gives me a list of recent buyers. Penelope Fluffington is on the list, but so is her rival, the notorious cat burglar, Madame Whiskers. Looks like I have a new lead. My hunch was right, this isn't about a missing dog, it's about a cat burglar with a new scheme. Case closed.",
                choices: [
                    { text: "Start a new case!", nextScene: 'start' }
                ]
            },
            tunnel_enter: {
                text: "I crawl through the tunnel, the air stale and dusty. My cat eyes adjust quickly to the darkness. I hear a faint whimpering sound ahead. A dog's whimpering. I follow it to a small, hidden room. Inside, Fifi is tied to a chair, but she's not a poodle. She's a Pomeranian in disguise. And she's not whimpering, she's laughing. I've walked right into a trap. 'Surprise, Mancat!' she purrs, pulling a gun from under the fake poodle fur. It's Penelope, the notorious cat burglar, in disguise. She had me chasing my own tail the whole time. This is my kind of case, but this time, I'm the one who's been caught. I should have trusted my gut, and not my whiskers.",
                choices: [
                    { text: "Restart and try again", nextScene: 'start' }
                ]
            }
        };

        // --- Global Variables ---
        let typingInterval;
        
        // --- DOM Elements ---
        const storyTextElement = document.getElementById('story-text');
        const dialogueBubble = document.getElementById('dialogue-bubble');
        const speakerNameElement = document.getElementById('speaker-name');
        const dialogueTextElement = document.getElementById('dialogue-text');
        const choicesContainer = document.getElementById('choices-container');
        const inventoryListElement = document.getElementById('inventory-list');
        const saveButton = document.getElementById('save-button');
        const loadButton = document.getElementById('load-button');
        const notebookToggle = document.getElementById('notebook-toggle');
        const notebookModal = document.getElementById('notebook-modal');
        const notebookTextarea = document.getElementById('notebook-textarea');
        const closeModalButton = document.querySelector('.close-button');

        // Initial game state
        let gameState = {
            currentScene: 'start',
            inventory: [],
            clues: { scratch_noise: false, dog_toy: false },
            notebookText: ''
        };

        // --- Save/Load Functions using localStorage ---
        const saveGame = () => {
            try {
                // Before saving, update the gameState with the current notebook text
                gameState.notebookText = notebookTextarea.value;
                // Convert the game state object to a JSON string and save it
                localStorage.setItem('mancatSaveState', JSON.stringify(gameState));
                alert('Game saved successfully!');
            } catch (error) {
                console.error('Error saving game:', error);
                alert('Error saving game.');
            }
        };

        const loadGame = () => {
            try {
                const savedState = localStorage.getItem('mancatSaveState');
                if (savedState) {
                    // Parse the JSON string back to an object and update game state
                    gameState = JSON.parse(savedState);
                    // Also load the notebook text
                    notebookTextarea.value = gameState.notebookText || '';
                    displayScene();
                    alert('Game loaded successfully!');
                } else {
                    alert('No saved game found. Starting a new case.');
                    // If no save exists, reset the game state
                    gameState = {
                        currentScene: 'start',
                        inventory: [],
                        clues: { scratch_noise: false, dog_toy: false },
                        notebookText: ''
                    };
                    notebookTextarea.value = '';
                    displayScene();
                }
            } catch (error) {
                console.error('Error loading game:', error);
                alert('Error loading game.');
            }
        };

        // --- Game Functions ---

        // Function to update the inventory display on the page
        function updateInventory() {
            if (gameState.inventory.length > 0) {
                inventoryListElement.textContent = gameState.inventory.join(', ');
            } else {
                inventoryListElement.textContent = 'Empty';
            }
        }

        // Function to simulate typing text for a cinematic effect
        function typeText(element, text) {
            element.textContent = '';
            let i = 0;
            if (typingInterval) clearInterval(typingInterval); 
            typingInterval = setInterval(() => {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                } else {
                    clearInterval(typingInterval);
                }
            }, 30); // Typing speed in milliseconds
        }

        // Main function to display a game scene
        function displayScene() {
            const currentSceneData = gameData[gameState.currentScene];
            
            // Execute the 'onEnter' function if it exists for the current scene
            if (currentSceneData.onEnter) {
                currentSceneData.onEnter(gameState);
            }

            // Check if the scene has a speaker for dialogue
            if (currentSceneData.speaker) {
                // Display dialogue bubble and hide narration text
                storyTextElement.style.display = 'none';
                dialogueBubble.style.display = 'flex';
                speakerNameElement.textContent = currentSceneData.speaker;
                typeText(dialogueTextElement, currentSceneData.text);
            } else {
                // Display narration text and hide dialogue bubble
                storyTextElement.style.display = 'block';
                dialogueBubble.style.display = 'none';
                typeText(storyTextElement, currentSceneData.text);
            }

            // Clear existing choice buttons
            choicesContainer.innerHTML = '';

            // Create new buttons for each choice in the current scene
            currentSceneData.choices.forEach(choice => {
                const button = document.createElement('button');
                button.textContent = choice.text;
                button.classList.add('choice-button');
                button.addEventListener('click', () => handleChoice(choice));
                choicesContainer.appendChild(button);
            });
            
            // Update the inventory display
            updateInventory();
        }

        // Function to handle a player's choice
        function handleChoice(choice) {
            // Update the game state to the next scene
            gameState.currentScene = choice.nextScene;
            // Display the new scene
            displayScene();
        }

        // --- Notebook Modal Functions ---
        function openNotebook() {
            notebookModal.style.display = 'flex';
        }
        
        function closeNotebook() {
            // Save notebook text to the game state before closing
            gameState.notebookText = notebookTextarea.value;
            notebookModal.style.display = 'none';
        }

        // --- Initialization ---
        window.onload = function() {
            // Display the initial scene
            displayScene();

            // Add event listeners for the save and load buttons
            saveButton.addEventListener('click', saveGame);
            loadButton.addEventListener('click', loadGame);
            
            // Add event listeners for the notebook
            notebookToggle.addEventListener('click', openNotebook);
            closeModalButton.addEventListener('click', closeNotebook);
            
            // Close the modal if the user clicks outside of the content area
            window.addEventListener('click', (event) => {
                if (event.target === notebookModal) {
                    closeNotebook();
                }
            });
        };
    </script>
</body>
</html>

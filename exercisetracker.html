<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym Session Tracker</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Custom font from Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* bg-slate-900 */
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- DATA MAPPING ---
        const defaultMuscleGroupMap = {
            'Bench Press': 'Chest', 'Incline Dumbbell Press': 'Chest', 'Dumbbell Chest Press': 'Chest', 'Standing Cable Chest Fly': 'Chest',
            'Deadlift': 'Back', 'Lat Pulldown': 'Back', 'Barbell Row': 'Back', 'Pull-Up': 'Back', 'Cable Close Grip Seated Row': 'Back', 'Dumbbell Row': 'Back', 'Face Pull': 'Back',
            'Squat': 'Legs', 'Leg Extension': 'Legs', 'Leg Press': 'Legs', 'Lying Leg Curl': 'Legs', 'Romanian Deadlift': 'Legs', 'Seated Leg Curl': 'Legs',
            'Overhead Press': 'Shoulders', 'Dumbbell Lateral Raise': 'Shoulders', 'Dumbbell Shoulder Press': 'Shoulders',
            'Barbell Curl': 'Arms', 'Dumbbell Curl': 'Arms', 'Hammer Curl': 'Arms', 'Tricep Pushdown With Bar': 'Arms', 'Tricep Pushdown With Rope': 'Arms',
        };

        // Main App Component
        const App = () => {
            // --- STATE MANAGEMENT ---
            const [exercises, setExercises] = React.useState([]);
            const [selectedExercise, setSelectedExercise] = React.useState('Bench Press');
            const [reps, setReps] = React.useState('');
            const [weight, setWeight] = React.useState('');
            const [totalWeight, setTotalWeight] = React.useState(0);
            const [muscleGroupTotals, setMuscleGroupTotals] = React.useState({});
            const [historicalData, setHistoricalData] = React.useState({});
            const [expandedRow, setExpandedRow] = React.useState(null);
            const [isModalOpen, setIsModalOpen] = React.useState(false);
            const [newExerciseName, setNewExerciseName] = React.useState('');
            const [newExerciseGroup, setNewExerciseGroup] = React.useState('Chest');
            const [customMuscleMap, setCustomMuscleMap] = React.useState({});

            // --- COMBINED EXERCISE DATA ---
            const combinedMuscleGroupMap = React.useMemo(() => ({ ...defaultMuscleGroupMap, ...customMuscleMap }), [customMuscleMap]);
            const exerciseOptions = React.useMemo(() => Object.keys(combinedMuscleGroupMap).sort(), [combinedMuscleGroupMap]);

            // --- EFFECTS ---
            React.useEffect(() => {
                try {
                    const savedSessionData = localStorage.getItem('gymSessionData');
                    if (savedSessionData) setHistoricalData(JSON.parse(savedSessionData));

                    const savedCustomExercises = localStorage.getItem('gymCustomExercises');
                    if (savedCustomExercises) setCustomMuscleMap(JSON.parse(savedCustomExercises));
                } catch (error) {
                    console.error("Failed to load data from localStorage", error);
                }
            }, []);

            React.useEffect(() => {
                const newTotalWeight = exercises.reduce((total, exercise) => total + (exercise.reps * exercise.weight), 0);
                setTotalWeight(newTotalWeight);

                const newMuscleTotals = {};
                exercises.forEach(exercise => {
                    const group = combinedMuscleGroupMap[exercise.name] || 'Other';
                    const volume = exercise.reps * exercise.weight;
                    newMuscleTotals[group] = (newMuscleTotals[group] || 0) + volume;
                });
                setMuscleGroupTotals(newMuscleTotals);
            }, [exercises, combinedMuscleGroupMap]);

            // --- LOGIC ---
            const handleAddExercise = (e) => {
                e.preventDefault();
                if (!selectedExercise || !reps || !weight) {
                    alert("Please fill in all fields.");
                    return;
                }
                const newExercise = { id: Date.now(), name: selectedExercise, reps: parseInt(reps, 10) || 0, weight: parseInt(weight, 10) || 0 };
                setExercises([...exercises, newExercise]);
                setReps('');
                setWeight('');
            };

            const handleRemoveExercise = (id) => setExercises(exercises.filter(exercise => exercise.id !== id));

            const handleSaveSession = () => {
                if (exercises.length === 0) {
                    alert("Add some exercises before saving!");
                    return;
                }
                const today = new Date().toISOString().split('T')[0];
                const newHistoricalData = { ...historicalData };
                const sessionData = { totalWeight: totalWeight, breakdown: muscleGroupTotals };

                if (newHistoricalData[today]) {
                    const existingSession = newHistoricalData[today];
                    const newTotal = existingSession.totalWeight + sessionData.totalWeight;
                    const newBreakdown = { ...existingSession.breakdown };
                    Object.entries(sessionData.breakdown).forEach(([group, weight]) => {
                        newBreakdown[group] = (newBreakdown[group] || 0) + weight;
                    });
                    newHistoricalData[today] = { totalWeight: newTotal, breakdown: newBreakdown };
                } else {
                    newHistoricalData[today] = sessionData;
                }

                try {
                    localStorage.setItem('gymSessionData', JSON.stringify(newHistoricalData));
                    setHistoricalData(newHistoricalData);
                    setExercises([]);
                    alert("Session saved successfully!");
                } catch (error) {
                    console.error("Failed to save session data", error);
                }
            };
            
            const handleSaveNewExercise = () => {
                if (!newExerciseName.trim()) {
                    alert("Please enter an exercise name.");
                    return;
                }
                const updatedCustomMap = { ...customMuscleMap, [newExerciseName.trim()]: newExerciseGroup };
                try {
                    localStorage.setItem('gymCustomExercises', JSON.stringify(updatedCustomMap));
                    setCustomMuscleMap(updatedCustomMap);
                    setNewExerciseName('');
                    setNewExerciseGroup('Chest');
                    setIsModalOpen(false);
                } catch (error) {
                    console.error("Failed to save custom exercise", error);
                }
            };

            const getWeightComparison = (weight) => {
                if (weight <= 0) return "Start lifting to see a comparison!";
                if (weight <= 1000) return "That's in the range of a grand piano!";
                if (weight <= 5000) return "That's about the weight of a small car!";
                if (weight <= 13000) return "You're approaching the weight of an African bush elephant!";
                if (weight <= 35000) return "That's the weight of a full-sized school bus!";
                if (weight <= 80000) return "You've lifted a fully loaded semi-truck trailer!";
                if (weight <= 170000) return "That's the empty weight of the Space Shuttle Orbiter!";
                if (weight <= 450000) return "You've lifted all the metal in the Statue of Liberty!";
                if (weight <= 1000000) return "You're lifting the weight of a small freight train!";
                return "You've lifted over a million pounds! That's legendary status.";
            };

            const last30DaysData = React.useMemo(() => {
                const data = [];
                for (let i = 0; i < 30; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateString = date.toISOString().split('T')[0];
                    const sessionData = historicalData[dateString];

                    if (sessionData) {
                        // FIX: Check if data is in the new object format or old number format
                        if (typeof sessionData === 'object' && sessionData !== null && sessionData.hasOwnProperty('totalWeight')) {
                            // New format, use as is
                            data.push({
                                date: date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }),
                                dateKey: dateString,
                                ...sessionData
                            });
                        } else if (typeof sessionData === 'number') {
                            // Old format, convert to new format
                            data.push({
                                date: date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }),
                                dateKey: dateString,
                                totalWeight: sessionData,
                                breakdown: {} // No breakdown available
                            });
                        }
                    }
                }
                return data;
            }, [historicalData]);

            const monthlyMuscleGroupData = React.useMemo(() => {
                const totals = {};
                last30DaysData.forEach(session => {
                    if (session.breakdown) {
                        Object.entries(session.breakdown).forEach(([group, weight]) => {
                            totals[group] = (totals[group] || 0) + weight;
                        });
                    }
                });
                return Object.entries(totals).map(([name, volume]) => ({ name, volume })).sort((a,b) => b.volume - a.volume);
            }, [last30DaysData]);

            // --- RENDER ---
            return (
                <div className="bg-slate-900 min-h-screen text-white p-4 sm:p-6 md:p-8">
                    {isModalOpen && (
                        <div className="modal-backdrop">
                            <div className="bg-slate-800 p-8 rounded-xl shadow-2xl w-full max-w-md m-4 border border-slate-700">
                                <h3 className="text-2xl font-bold mb-6 text-white text-center">Add a Custom Exercise</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="new-exercise-name" className="block mb-2 font-semibold text-slate-300">Exercise Name</label>
                                        <input id="new-exercise-name" type="text" value={newExerciseName} onChange={(e) => setNewExerciseName(e.target.value)} placeholder="e.g., Cable Crossover" className="w-full p-3 bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none" />
                                    </div>
                                    <div>
                                        <label htmlFor="new-exercise-group" className="block mb-2 font-semibold text-slate-300">Muscle Group</label>
                                        <select id="new-exercise-group" value={newExerciseGroup} onChange={(e) => setNewExerciseGroup(e.target.value)} className="w-full p-3 bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none">
                                            <option>Chest</option><option>Back</option><option>Legs</option><option>Shoulders</option><option>Arms</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="mt-8 flex justify-end space-x-4">
                                    <button onClick={() => setIsModalOpen(false)} className="py-2 px-4 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-md transition">Cancel</button>
                                    <button onClick={handleSaveNewExercise} className="py-2 px-4 bg-cyan-500 hover:bg-cyan-600 text-white font-semibold rounded-md transition">Save Exercise</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="max-w-4xl mx-auto">
                        <header className="text-center mb-8">
                            <h1 className="text-4xl md:text-5xl font-bold text-cyan-400">Gym Session Tracker</h1>
                            <p className="text-slate-400 mt-2">Log your sets, save your session, and track your progress.</p>
                        </header>
                        
                        <div className="bg-slate-800 rounded-xl p-6 mb-8 shadow-lg border border-slate-700 text-center">
                            <h2 className="text-lg font-semibold text-slate-300 mb-2">Total Session Volume</h2>
                            <p className="text-5xl font-bold text-cyan-400">{totalWeight.toLocaleString()}<span className="text-2xl text-slate-400 ml-2">lbs</span></p>
                            <p className="text-slate-400 mt-4 text-lg italic">{getWeightComparison(totalWeight)}</p>
                            
                            {Object.keys(muscleGroupTotals).length > 0 && (
                                <div className="mt-6 pt-4 border-t border-slate-700">
                                    <h3 className="text-lg font-semibold text-slate-300 mb-3">Volume by Muscle Group</h3>
                                    <ul className="space-y-1 text-sm max-w-xs mx-auto">
                                        {Object.entries(muscleGroupTotals).sort(([, a], [, b]) => b - a).map(([group, groupTotal]) => (
                                            <li key={group} className="flex justify-between items-center bg-slate-700/50 px-3 py-1 rounded-md">
                                                <span className="font-semibold text-slate-300">{group}</span>
                                                <span className="font-bold text-cyan-400/90">{groupTotal.toLocaleString()} lbs</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            )}
                        </div>

                        <div className="bg-slate-800 rounded-xl p-6 mb-8 shadow-lg border border-slate-700">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-2xl font-bold text-white">Add a Set</h2>
                                <button onClick={() => setIsModalOpen(true)} className="text-sm bg-cyan-500/20 hover:bg-cyan-500/40 text-cyan-300 font-semibold py-2 px-3 rounded-md transition">Add Custom Exercise</button>
                            </div>
                            <form onSubmit={handleAddExercise}>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div className="flex flex-col">
                                        <label htmlFor="exercise" className="mb-2 font-semibold text-slate-300">Exercise</label>
                                        <select id="exercise" value={selectedExercise} onChange={(e) => setSelectedExercise(e.target.value)} className="p-3 bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none">
                                            {exerciseOptions.map(option => <option key={option} value={option}>{option}</option>)}
                                        </select>
                                    </div>
                                    <div className="flex flex-col">
                                        <label htmlFor="reps" className="mb-2 font-semibold text-slate-300">Reps</label>
                                        <input id="reps" type="number" value={reps} onChange={(e) => setReps(e.target.value)} placeholder="e.g., 10" className="p-3 bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none" />
                                    </div>
                                    <div className="flex flex-col">
                                        <label htmlFor="weight" className="mb-2 font-semibold text-slate-300">Weight (lbs)</label>
                                        <input id="weight" type="number" value={weight} onChange={(e) => setWeight(e.target.value)} placeholder="e.g., 135" className="p-3 bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none" />
                                    </div>
                                </div>
                                <button type="submit" className="w-full mt-6 bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-4 rounded-md transition duration-300 shadow-md hover:shadow-lg">Add Exercise to Session</button>
                            </form>
                        </div>

                        <div className="mb-12">
                            <div className="flex justify-between items-center mb-4">
                                 <h2 className="text-2xl font-bold text-white">Current Session Log</h2>
                                 <button onClick={handleSaveSession} className="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-md transition duration-300 shadow-md">Save Session</button>
                            </div>
                            {exercises.length === 0 ? (
                                <div className="bg-slate-800 rounded-lg p-8 text-center border border-slate-700"><p className="text-slate-400">No sets logged yet.</p></div>
                            ) : (
                                <ul className="space-y-4">
                                    {exercises.map(exercise => (
                                        <li key={exercise.id} className="bg-slate-800 rounded-lg p-4 flex items-center justify-between shadow-md border border-slate-700 hover:border-cyan-500 transition-colors duration-300">
                                            <div>
                                                <p className="font-bold text-lg text-white">{exercise.name}</p>
                                                <p className="text-slate-400">{exercise.reps} reps @ {exercise.weight} lbs</p>
                                                <p className="text-cyan-400 font-semibold">Volume: {(exercise.reps * exercise.weight).toLocaleString()} lbs</p>
                                            </div>
                                            <button onClick={() => handleRemoveExercise(exercise.id)} className="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-3 rounded-md transition duration-300 text-sm">Remove</button>
                                        </li>
                                    ))}
                                </ul>
                            )}
                        </div>

                        <div className="mb-12">
                            <h2 className="text-2xl font-bold mb-4 text-white">Last 30 Days of Lifting</h2>
                            <div className="bg-slate-800 rounded-xl p-6 shadow-lg border border-slate-700">
                                {last30DaysData.length === 0 ? (
                                    <p className="text-slate-400 text-center">No saved sessions in the last 30 days.</p>
                                ) : (
                                    <ul className="space-y-2">
                                        {last30DaysData.map(session => (
                                            <li key={session.dateKey} className="bg-slate-700 rounded-md overflow-hidden transition-all duration-300">
                                                <div className="flex justify-between items-center p-3 cursor-pointer hover:bg-slate-600/50" onClick={() => setExpandedRow(expandedRow === session.dateKey ? null : session.dateKey)}>
                                                    <span className="font-semibold text-slate-300">{session.date}</span>
                                                    <div className="flex items-center space-x-4">
                                                        <span className="font-bold text-cyan-400">{session.totalWeight.toLocaleString()} lbs</span>
                                                        <svg className={`w-5 h-5 text-slate-400 transition-transform duration-300 ${expandedRow === session.dateKey ? 'rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                                                    </div>
                                                </div>
                                                {expandedRow === session.dateKey && (
                                                    <div className="p-4 border-t border-slate-600 bg-slate-800/50">
                                                        <h4 className="text-md font-semibold text-slate-300 mb-2 text-center">Workout Breakdown</h4>
                                                        {session.breakdown && Object.keys(session.breakdown).length > 0 ? (
                                                            <ul className="space-y-1 text-sm max-w-xs mx-auto">
                                                                {Object.entries(session.breakdown).sort(([, a], [, b]) => b - a).map(([group, groupTotal]) => (
                                                                    <li key={group} className="flex justify-between items-center bg-slate-700/50 px-3 py-1 rounded-md">
                                                                        <span className="font-semibold text-slate-400">{group}</span>
                                                                        <span className="font-bold text-cyan-400/90">{groupTotal.toLocaleString()} lbs</span>
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        ) : (
                                                            <p className="text-slate-500 text-center text-sm">No breakdown available for this session.</p>
                                                        )}
                                                    </div>
                                                )}
                                            </li>
                                        ))}
                                    </ul>
                                )}
                            </div>
                        </div>

                        <div>
                            <h2 className="text-2xl font-bold mb-4 text-white">Last 30 Days Volume by Muscle Group</h2>
                            <div className="bg-slate-800 rounded-xl p-6 shadow-lg border border-slate-700">
                                {monthlyMuscleGroupData.length > 0 ? (
                                    <table className="w-full text-left">
                                        <thead className="border-b border-slate-600">
                                            <tr>
                                                <th className="pb-2 font-semibold text-slate-300">Muscle Group</th>
                                                <th className="pb-2 font-semibold text-slate-300 text-right">Total Volume</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-700">
                                            {monthlyMuscleGroupData.map(item => (
                                                <tr key={item.name}>
                                                    <td className="py-2 text-slate-400">{item.name}</td>
                                                    <td className="py-2 font-bold text-cyan-400 text-right">{item.volume.toLocaleString()} lbs</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                ) : (
                                    <p className="text-slate-400 text-center">No data to display. Save a session to get started.</p>
                                )}
                            </div>
                        </div>

                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

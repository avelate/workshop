<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym tracker</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Custom font from Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* bg-slate-900 */
        }
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        /* Custom styles for touch-friendly form inputs */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        /* New styling for the fixed button at the bottom of the screen */
        .fixed-bottom-button-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 40;
            padding: 1rem;
            background-color: #0f172a;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.3);
        }
        .round-button {
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 48px; /* Set a fixed size to ensure it's a perfect circle */
            height: 48px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- DATA MAPPING ---
        // A default map of exercises to their primary muscle groups.
        const defaultMuscleGroupMap = {
            'Bench Press': 'Chest', 'Incline Dumbbell Press': 'Chest', 'Dumbbell Chest Press': 'Chest', 'Standing Cable Chest Fly': 'Chest',
            'Deadlift': 'Back', 'Lat Pulldown': 'Back', 'Barbell Row': 'Back', 'Pull-Up': 'Back', 'Cable Close Grip Seated Row': 'Back', 'Dumbbell Row': 'Back', 'Face Pull': 'Back',
            'Squat': 'Legs', 'Leg Extension': 'Legs', 'Leg Press': 'Legs', 'Lying Leg Curl': 'Legs', 'Romanian Deadlift': 'Legs', 'Seated Leg Curl': 'Legs',
            'Overhead Press': 'Shoulders', 'Dumbbell Lateral Raise': 'Shoulders', 'Dumbbell Shoulder Press': 'Shoulders',
            'Barbell Curl': 'Arms', 'Dumbbell Curl': 'Arms', 'Hammer Curl': 'Arms', 'Tricep Pushdown With Bar': 'Arms', 'Tricep Pushdown With Rope': 'Arms',
            'Dips': 'Back', 'Pec Flies': 'Chest', 'Calf Extensions': 'Legs',
        };
        
        // List of bodyweight-based exercises to auto-fill weight
        const bodyweightExercises = ['Pull-Up', 'Dips'];

        const App = () => {
            const [userWeight, setUserWeight] = React.useState('');
            const [exercises, setExercises] = React.useState([]);
            const [selectedExercise, setSelectedExercise] = React.useState('Bench Press');
            const [reps, setReps] = React.useState('');
            const [weight, setWeight] = React.useState('');
            const [quantity, setQuantity] = React.useState(1);
            const [totalWeight, setTotalWeight] = React.useState(0);
            const [totalCalories, setTotalCalories] = React.useState(0);
            const [muscleGroupTotals, setMuscleGroupTotals] = React.useState({});
            const [historicalData, setHistoricalData] = React.useState({});
            const [expandedRow, setExpandedRow] = React.useState(null);
            const [isAddSetModalOpen, setIsAddSetModalOpen] = React.useState(false);
            const [isAddExerciseModalOpen, setIsAddExerciseModalOpen] = React.useState(false);
            const [isMessageModalOpen, setIsMessageModalOpen] = React.useState(false);
            const [isUserWeightModalOpen, setIsUserWeightModalOpen] = React.useState(false);
            const [isKcalInfoModalOpen, setIsKcalInfoModalOpen] = React.useState(false);
            const [message, setMessage] = React.useState('');
            const [newExerciseName, setNewExerciseName] = React.useState('');
            const [newExerciseGroup, setNewExerciseGroup] = React.useState('Chest');
            const [customMuscleMap, setCustomMuscleMap] = React.useState({});
            const [isTimerRunning, setIsTimerRunning] = React.useState(false);
            const [startTime, setStartTime] = React.useState(null);
            const [elapsedTime, setElapsedTime] = React.useState(0);
            const [visibleSessions, setVisibleSessions] = React.useState(10);
            const [timePeriod, setTimePeriod] = React.useState('7-days');
            
            const combinedMuscleGroupMap = React.useMemo(() => ({ ...defaultMuscleGroupMap, ...customMuscleMap }), [customMuscleMap]);
            const exerciseOptions = React.useMemo(() => Object.keys(combinedMuscleGroupMap).sort(), [combinedMuscleGroupMap]);

            React.useEffect(() => {
                try {
                    const savedSessionData = localStorage.getItem('gymSessionData');
                    if (savedSessionData) setHistoricalData(JSON.parse(savedSessionData));

                    const savedCustomExercises = localStorage.getItem('gymCustomExercises');
                    if (savedCustomExercises) setCustomMuscleMap(JSON.parse(savedCustomExercises));

                    const savedWeight = localStorage.getItem('userWeight');
                    if (savedWeight) setUserWeight(savedWeight);
                } catch (error) {
                    console.error("Failed to load data from localStorage", error);
                }
            }, []);

            React.useEffect(() => {
                const newTotalWeight = exercises.reduce((total, exercise) => total + (exercise.reps * exercise.weight), 0);
                setTotalWeight(newTotalWeight);
                
                const newMuscleTotals = {};
                exercises.forEach(exercise => {
                    const group = combinedMuscleGroupMap[exercise.name] || 'Other';
                    const volume = exercise.reps * exercise.weight;
                    newMuscleTotals[group] = (newMuscleTotals[group] || 0) + volume;
                });
                setMuscleGroupTotals(newMuscleTotals);
            }, [exercises, combinedMuscleGroupMap]);

            React.useEffect(() => {
                if (userWeight) localStorage.setItem('userWeight', userWeight);
            }, [userWeight]);

            React.useEffect(() => {
                let interval = null;
                if (isTimerRunning) {
                    interval = setInterval(() => {
                        const newElapsedTime = Math.floor((Date.now() - startTime) / 1000);
                        setElapsedTime(newElapsedTime);
                        
                        const newTotalCalories = calculateTotalCalories(newElapsedTime);
                        setTotalCalories(newTotalCalories);
                    }, 1000);
                } else if (!isTimerRunning && elapsedTime !== 0) {
                    clearInterval(interval);
                }
                return () => clearInterval(interval);
            }, [isTimerRunning, startTime, elapsedTime, userWeight]);

            const showMessage = (msg) => {
                setMessage(msg);
                setIsMessageModalOpen(true);
            };
            
            const calculateTotalCalories = (totalSeconds) => {
                const userWeightInLbs = parseFloat(userWeight);
                if (!userWeightInLbs || isNaN(userWeightInLbs) || userWeightInLbs <= 0) {
                    return 0;
                }
                const metValue = 6.0;
                const weightKg = userWeightInLbs / 2.20462;
                const calories = (metValue * 3.5 * weightKg * (totalSeconds / 60)) / 200;
                
                return Math.round(calories);
            };

            const handleAddExercise = (e) => {
                e.preventDefault();
                if (!selectedExercise || reps === '' || weight === '' || quantity < 1) {
                    showMessage("Please fill in all fields.");
                    return;
                }
                const newSets = [];
                for (let i = 0; i < quantity; i++) {
                    newSets.push({
                        id: Date.now() + i,
                        name: selectedExercise,
                        reps: parseInt(reps, 10) || 0,
                        weight: parseInt(weight, 10) || 0,
                    });
                }
                setExercises([...exercises, ...newSets]);
                setReps('');
                setWeight('');
                setQuantity(1);
                setIsAddSetModalOpen(false);
            };

            const handleExerciseChange = (e) => {
                const newExercise = e.target.value;
                setSelectedExercise(newExercise);
                if (bodyweightExercises.includes(newExercise)) {
                    setWeight(userWeight);
                } else {
                    setWeight('');
                }
            };

            const handleRemoveExercise = (id) => setExercises(exercises.filter(exercise => exercise.id !== id));

            const handleSaveSession = () => {
                if (exercises.length === 0) {
                    showMessage("Add some exercises before saving!");
                    return;
                }
                const today = new Date().toISOString().split('T')[0];
                const newHistoricalData = { ...historicalData };
                const sessionData = { totalWeight: totalWeight, breakdown: muscleGroupTotals, totalCalories: totalCalories };

                if (newHistoricalData[today]) {
                    const existingSession = newHistoricalData[today];
                    const newTotalWeight = existingSession.totalWeight + sessionData.totalWeight;
                    const newTotalCalories = (existingSession.totalCalories || 0) + sessionData.totalCalories;
                    const newBreakdown = { ...existingSession.breakdown };
                    Object.entries(sessionData.breakdown).forEach(([group, weight]) => {
                        newBreakdown[group] = (newBreakdown[group] || 0) + weight;
                    });
                    newHistoricalData[today] = { totalWeight: newTotalWeight, totalCalories: newTotalCalories, breakdown: newBreakdown };
                } else {
                    newHistoricalData[today] = sessionData;
                }

                const dates = Object.keys(newHistoricalData).sort((a, b) => new Date(b) - new Date(a));
                const limitedData = {};
                for (let i = 0; i < Math.min(dates.length, 100); i++) {
                    limitedData[dates[i]] = newHistoricalData[dates[i]];
                }
                
                try {
                    localStorage.setItem('gymSessionData', JSON.stringify(limitedData));
                    setHistoricalData(limitedData);
                    setExercises([]);
                    setIsTimerRunning(false);
                    setStartTime(null);
                    setElapsedTime(0);
                    setTotalCalories(0);
                    showMessage("Session saved successfully!");
                } catch (error) {
                    console.error("Failed to save session data", error);
                    showMessage("An error occurred while saving your session.");
                }
            };
            
            const handleSaveNewExercise = () => {
                if (!newExerciseName.trim()) {
                    showMessage("Please enter an exercise name.");
                    return;
                }
                const updatedCustomMap = { ...customMuscleGroupMap, [newExerciseName.trim()]: newExerciseGroup };
                try {
                    localStorage.setItem('gymCustomExercises', JSON.stringify(updatedCustomMap));
                    setCustomMuscleMap(updatedCustomMap);
                    setSelectedExercise(newExerciseName.trim());
                    setNewExerciseName('');
                    setNewExerciseGroup('Chest');
                    setIsAddExerciseModalOpen(false);
                    setIsAddSetModalOpen(true);
                } catch (error) {
                    console.error("Failed to save custom exercise", error);
                    showMessage("An error occurred while saving the custom exercise.");
                }
            };
            
            const handleDeleteSession = (dateKey) => {
                const newHistoricalData = { ...historicalData };
                delete newHistoricalData[dateKey];
                try {
                    localStorage.setItem('gymSessionData', JSON.stringify(newHistoricalData));
                    setHistoricalData(newHistoricalData);
                    showMessage(`Session for ${dateKey} has been deleted.`);
                } catch (error) {
                    console.error("Failed to delete session data", error);
                    showMessage("An error occurred while deleting the session.");
                }
            };

            const allSessions = React.useMemo(() => {
                return Object.keys(historicalData).sort((a, b) => new Date(b) - new Date(a)).map(dateKey => ({
                    date: new Date(dateKey).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }),
                    dateKey,
                    ...historicalData[dateKey]
                }));
            }, [historicalData]);

            const visiblePastSessions = React.useMemo(() => {
                return allSessions.slice(0, visibleSessions);
            }, [allSessions, visibleSessions]);

            const handleLoadMore = () => {
                setVisibleSessions(prevCount => prevCount + 10);
            };

            const getFilteredMuscleGroupData = React.useCallback(() => {
                const today = new Date();
                let startDate;
                const totals = {};

                switch (timePeriod) {
                    case '7-days':
                        startDate = new Date();
                        startDate.setDate(today.getDate() - 7);
                        break;
                    case 'this-month':
                        startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                        break;
                    case 'last-month':
                        startDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                        const endDate = new Date(today.getFullYear(), today.getMonth(), 0);
                        Object.entries(historicalData).forEach(([dateStr, session]) => {
                            const sessionDate = new Date(dateStr);
                            if (sessionDate >= startDate && sessionDate <= endDate) {
                                if (session.breakdown) {
                                    Object.entries(session.breakdown).forEach(([group, weight]) => {
                                        totals[group] = (totals[group] || 0) + weight;
                                    });
                                }
                            }
                        });
                        return Object.entries(totals).map(([name, volume]) => ({ name, volume })).sort((a,b) => b.volume - a.volume);
                    case 'this-year':
                        startDate = new Date(today.getFullYear(), 0, 1);
                        break;
                    default:
                        startDate = new Date(0); // All time
                        break;
                }

                Object.entries(historicalData).forEach(([dateStr, session]) => {
                    const sessionDate = new Date(dateStr);
                    if (sessionDate >= startDate) {
                        if (session.breakdown) {
                            Object.entries(session.breakdown).forEach(([group, weight]) => {
                                totals[group] = (totals[group] || 0) + weight;
                            });
                        }
                    }
                });

                return Object.entries(totals).map(([name, volume]) => ({ name, volume })).sort((a,b) => b.volume - a.volume);
            }, [historicalData, timePeriod]);

            const filteredMuscleGroupData = getFilteredMuscleGroupData();
            
            const getDateRangeText = () => {
                const today = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                switch(timePeriod) {
                    case '7-days':
                        const sevenDaysAgo = new Date();
                        sevenDaysAgo.setDate(today.getDate() - 7);
                        return `From ${sevenDaysAgo.toLocaleDateString('en-US', options)} to ${today.toLocaleDateString('en-US', options)}`;
                    case 'this-month':
                        const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
                        return `From ${startOfMonth.toLocaleDateString('en-US', options)} to ${today.toLocaleDateString('en-US', options)}`;
                    case 'last-month':
                        const startOfLastMonth = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                        const endOfLastMonth = new Date(today.getFullYear(), today.getMonth(), 0);
                        return `From ${startOfLastMonth.toLocaleDateString('en-US', options)} to ${endOfLastMonth.toLocaleDateString('en-US', options)}`;
                    case 'this-year':
                        const startOfYear = new Date(today.getFullYear(), 0, 1);
                        return `From ${startOfYear.toLocaleDateString('en-US', options)} to ${today.toLocaleDateString('en-US', options)}`;
                    default:
                        return 'All time';
                }
            };
            const dateRangeText = getDateRangeText();

            const formatTime = (seconds) => {
                const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
                const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                return `${h}:${m}:${s}`;
            };
            
            const caloriesPerHour = React.useMemo(() => {
                const userWeightInLbs = parseFloat(userWeight);
                if (!userWeightInLbs || isNaN(userWeightInLbs) || userWeightInLbs <= 0) {
                    return 0;
                }
                const metValue = 6.0;
                const weightKg = userWeightInLbs / 2.20462;
                return Math.round((metValue * 3.5 * weightKg) / 200 * 60);
            }, [userWeight]);

            const totalSessions = Object.keys(historicalData).length;

            // --- RENDER ---
            return (
                <div className="bg-slate-900 min-h-screen text-white p-4 sm:p-6 md:p-8">
                    {isAddSetModalOpen && (
                        <div className="modal-backdrop">
                            <div className="bg-slate-800 p-8 rounded-xl shadow-2xl w-full max-w-md m-4 border border-slate-700">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-2xl font-bold text-white">Add new sets</h3>
                                    <p onClick={() => {
                                        setIsAddExerciseModalOpen(true);
                                        setIsAddSetModalOpen(false);
                                    }} className="text-sm cursor-pointer hover:underline text-white font-semibold transition">Add custom exercise</p>
                                </div>
                                <form onSubmit={handleAddExercise}>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="flex flex-col">
                                            <label htmlFor="exercise" className="mb-2 font-semibold text-slate-300">Exercise</label>
                                            <select id="exercise" value={selectedExercise} onChange={handleExerciseChange} className="p-3 bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none">
                                                {exerciseOptions.map(option => <option key={option} value={option}>{option}</option>)}
                                            </select>
                                        </div>
                                        <div className="flex flex-col">
                                            <label htmlFor="reps" className="mb-2 font-semibold text-slate-300">Reps</label>
                                            <input id="reps" type="number" value={reps} onChange={(e) => setReps(e.target.value)} placeholder="e.g., 10" className="p-3 bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none" />
                                        </div>
                                        <div className="flex flex-col">
                                            <label htmlFor="weight" className="mb-2 font-semibold text-slate-300">Weight (lbs)</label>
                                            <input id="weight" type="number" value={weight} onChange={(e) => setWeight(e.target.value)} placeholder="e.g., 135" className="p-3 bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none" />
                                        </div>
                                        <div className="flex flex-col">
                                            <label htmlFor="quantity" className="mb-2 font-semibold text-slate-300">Sets</label>
                                            <input id="quantity" type="number" value={quantity} onChange={(e) => setQuantity(e.target.value)} placeholder="e.g., 3" className="p-3 bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none" />
                                        </div>
                                    </div>
                                    <div className="mt-6 flex justify-between items-center">
                                        <button onClick={() => setIsAddSetModalOpen(false)} type="button" className="w-1/2 mr-2 py-3 px-6 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-md transition duration-300 shadow-md">Cancel</button>
                                        <button type="submit" className="w-1/2 ml-2 py-3 px-6 bg-cyan-500 hover:bg-cyan-600 text-white font-bold rounded-md transition duration-300 shadow-md hover:shadow-lg">Add sets</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {isAddExerciseModalOpen && (
                        <div className="modal-backdrop">
                            <div className="bg-slate-800 p-8 rounded-xl shadow-2xl w-full max-w-md m-4 border border-slate-700">
                                <h3 className="text-2xl font-bold mb-6 text-white text-center">Add custom exercise</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="new-exercise-name" className="block mb-2 font-semibold text-slate-300">Exercise name</label>
                                        <input id="new-exercise-name" type="text" value={newExerciseName} onChange={(e) => setNewExerciseName(e.target.value)} placeholder="e.g., Cable Crossover" className="w-full p-3 bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none" />
                                    </div>
                                    <div>
                                        <label htmlFor="new-exercise-group" className="block mb-2 font-semibold text-slate-300">Muscle group</label>
                                        <select id="new-exercise-group" value={newExerciseGroup} onChange={(e) => setNewExerciseGroup(e.target.value)} className="w-full p-3 bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none">
                                            <option>Chest</option><option>Back</option><option>Legs</option><option>Shoulders</option><option>Arms</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="mt-8 flex justify-end space-x-4">
                                    <button onClick={() => setIsAddExerciseModalOpen(false)} className="py-2 px-4 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-md transition">Cancel</button>
                                    <button onClick={handleSaveNewExercise} className="py-2 px-4 bg-cyan-500 hover:bg-cyan-600 text-white font-semibold rounded-md transition">Save</button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {isUserWeightModalOpen && (
                        <div className="modal-backdrop">
                            <div className="bg-slate-800 p-8 rounded-xl shadow-2xl w-full max-w-md m-4 border border-slate-700 text-center">
                                <h3 className="text-2xl font-bold mb-6 text-white text-center">Your Weight</h3>
                                <div className="px-4">
                                    <label htmlFor="user-weight" className="block text-sm font-semibold text-slate-300">Your Weight (lbs)</label>
                                    <input id="user-weight" type="number" value={userWeight} onChange={(e) => setUserWeight(e.target.value)} placeholder="e.g., 180" className="p-2 mt-1 w-full text-center bg-slate-700 text-white rounded-md border border-slate-600 focus:ring-2 focus:ring-cyan-500 focus:outline-none" />
                                </div>
                                <div className="mt-8 flex justify-center">
                                    <button onClick={() => setIsUserWeightModalOpen(false)} className="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-md transition duration-300 shadow-md hover:shadow-lg">Done</button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {isKcalInfoModalOpen && (
                        <div className="modal-backdrop">
                            <div className="bg-slate-800 p-8 rounded-xl shadow-2xl w-full max-w-md m-4 border border-slate-700">
                                <h3 className="text-2xl font-bold mb-4 text-white text-center">How calories are calculated</h3>
                                <p className="text-slate-300 mb-4">
                                    The calorie estimate for your session is based on the Metabolic Equivalent of Task (MET) formula, which is a standard way to estimate energy expenditure.
                                </p>
                                <p className="text-slate-300 mb-4">
                                    The calculation uses your body weight and the total time of your workout. We use a MET value of 6.0 for vigorous weightlifting, which means you burn roughly {caloriesPerHour} kcal/hour for your current weight of {userWeight || 'N/A'} lbs.
                                </p>
                                <p className="text-slate-300 mb-4">
                                    The formula is: Calories = (METs * 3.5 * Bodyweight (kg) / 200) * minutes
                                </p>
                                <div className="mt-8 flex justify-center">
                                    <button onClick={() => setIsKcalInfoModalOpen(false)} className="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-md transition duration-300 shadow-md hover:shadow-lg">Close</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {isMessageModalOpen && (
                        <div className="modal-backdrop">
                            <div className="bg-slate-800 p-8 rounded-xl shadow-2xl w-full max-w-sm m-4 border border-slate-700 text-center">
                                <p className="text-white text-lg font-semibold mb-6">{message}</p>
                                <button onClick={() => setIsMessageModalOpen(false)} className="bg-cyan-500 hover:bg-cyan-600 text-white font-semibold py-2 px-4 rounded-md transition">OK</button>
                            </div>
                        </div>
                    )}

                    <div className="max-w-4xl mx-auto">
                        <header className="text-center mb-8">
                            <h1 className="text-4xl md:text-5xl font-bold text-white">Gym session tracker</h1>
                        </header>
                        
                        {/* Session Timer */}
                        <div className="bg-slate-800 rounded-xl p-4 mb-8 shadow-lg border border-slate-700 text-center">
                            <h2 className="text-2xl font-bold text-white mx-auto">Timer</h2>
                            <div className="flex items-center justify-center space-x-2">
                                <button onClick={() => {
                                    if (isTimerRunning) {
                                        setIsTimerRunning(false);
                                    } else {
                                        setIsTimerRunning(true);
                                        if (startTime === null) setStartTime(Date.now());
                                    }
                                }} className={`p-3 rounded-full transition bg-cyan-500 hover:bg-cyan-600 round-button`}>
                                    {isTimerRunning ? (
                                        <span className="text-xl text-white">❚❚</span>
                                    ) : (
                                        <span className="text-xl text-white">▶</span>
                                    )}
                                </button>
                                <p className="text-3xl font-mono font-bold text-white">{formatTime(elapsedTime)}</p>
                                <button onClick={() => {
                                    setIsTimerRunning(false);
                                    setStartTime(null);
                                    setElapsedTime(0);
                                }} className="p-3 rounded-full transition bg-cyan-500 hover:bg-cyan-600 round-button">
                                    <span className="text-xl text-white">◼</span>
                                </button>
                            </div>
                            <p className="text-sm mt-4 text-slate-400">Your weight: <span className="font-bold text-white">{userWeight ? `${userWeight} lbs` : 'Not set'}</span></p>
                            <button onClick={() => setIsUserWeightModalOpen(true)} className="mt-2 py-2 px-4 text-white font-semibold rounded-md transition bg-cyan-500 hover:bg-cyan-600">
                                Edit weight
                            </button>
                        </div>

                        {/* Session Stats */}
                        <div className="bg-slate-800 rounded-xl p-6 mb-8 shadow-lg border border-slate-700 text-center">
                            <h2 className="text-2xl font-bold text-white mx-auto">Stats</h2>
                            <div className="flex justify-between items-center px-4 py-2 bg-slate-700 rounded-lg">
                                <p className="text-xl font-bold text-white">{totalWeight.toLocaleString()}<span className="text-sm text-slate-400 ml-1">lbs</span></p>
                                <div className="flex items-center">
                                    <p className="text-xl font-bold text-white">{totalCalories.toLocaleString()}<span className="text-sm text-slate-400 ml-1">kcal</span></p>
                                    <button onClick={() => setIsKcalInfoModalOpen(true)} className="ml-2 p-1 rounded-full text-slate-400 hover:text-white transition">
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            {Object.keys(muscleGroupTotals).length > 0 && (
                                <div className="mt-6 pt-4 border-t border-slate-700">
                                    <h3 className="text-lg font-semibold text-slate-300 mb-3">Volume by Muscle Group</h3>
                                    <ul className="space-y-1 text-sm max-w-xs mx-auto">
                                        {Object.entries(muscleGroupTotals).sort(([, a], [, b]) => b - a).map(([group, groupTotal]) => (
                                            <li key={group} className="flex justify-between items-center bg-slate-700/50 px-3 py-1 rounded-md">
                                                <span className="font-semibold text-slate-300">{group}</span>
                                                <span className="font-bold text-white">{groupTotal.toLocaleString()} lbs</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            )}
                        </div>
                        
                        {/* Current Session Log */}
                        <div className="mb-8">
                            <h2 className="text-2xl font-bold text-white text-center mb-4">Session log</h2>
                            <div className="flex justify-center mb-4">
                                <button onClick={handleSaveSession} className="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-md transition duration-300 shadow-md">Save session</button>
                            </div>
                            {exercises.length === 0 ? (
                                <div className="bg-slate-800 rounded-lg p-8 text-center border border-slate-700"><p className="text-slate-400">No sets logged yet.</p></div>
                            ) : (
                                <ul className="space-y-4">
                                    {exercises.map(exercise => (
                                        <li key={exercise.id} className="bg-slate-800 rounded-lg p-4 flex items-center justify-between shadow-md border border-slate-700 hover:border-cyan-500 transition-colors duration-300">
                                            <div>
                                                <p className="font-bold text-lg text-white">{exercise.name}</p>
                                                <p className="text-slate-400">{exercise.reps} reps @ {exercise.weight} lbs</p>
                                                <p className="font-semibold text-white">Volume: {(exercise.reps * exercise.weight).toLocaleString()} lbs</p>
                                            </div>
                                            <button onClick={() => handleRemoveExercise(exercise.id)} className="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-3 rounded-md transition duration-300 text-sm">Remove</button>
                                        </li>
                                    ))}
                                </ul>
                            )}
                        </div>

                        {/* Historical Data */}
                        <div className="mb-12">
                            <h2 className="text-2xl font-bold text-white mb-4 text-center">Past sessions</h2>
                            <div className="bg-slate-800 rounded-xl p-6 shadow-lg border border-slate-700">
                                {Object.keys(historicalData).length === 0 ? (
                                    <p className="text-slate-400 text-center">No saved sessions yet.</p>
                                ) : (
                                    <ul className="space-y-2">
                                        {visiblePastSessions.map(session => (
                                            <li key={session.dateKey} className="bg-slate-700 rounded-md overflow-hidden transition-all duration-300">
                                                <div className="flex justify-between items-center p-3 cursor-pointer hover:bg-slate-600/50" onClick={() => setExpandedRow(expandedRow === session.dateKey ? null : session.dateKey)}>
                                                    <span className="font-semibold text-slate-300">{session.date}</span>
                                                    <div className="flex items-center space-x-4">
                                                        <span className="font-bold text-white">{session.totalWeight.toLocaleString()} lbs</span>
                                                        <svg className={`w-5 h-5 text-slate-400 transition-transform duration-300 ${expandedRow === session.dateKey ? 'rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                                                    </div>
                                                </div>
                                                {expandedRow === session.dateKey && (
                                                    <div className="p-4 border-t border-slate-600 bg-slate-800/50">
                                                        <h4 className="text-md font-semibold text-slate-300 mb-2 text-center">Workout details</h4>
                                                        <div className="flex justify-around items-center mb-4">
                                                            <p className="font-semibold text-white">Volume: {session.totalWeight.toLocaleString()} lbs</p>
                                                            <p className="font-semibold text-white">Calories: {(session.totalCalories || 0).toLocaleString()} kcal</p>
                                                        </div>
                                                        {session.breakdown && Object.keys(session.breakdown).length > 0 ? (
                                                            <ul className="space-y-1 text-sm max-w-xs mx-auto">
                                                                {Object.entries(session.breakdown).sort(([, a], [, b]) => b - a).map(([group, groupTotal]) => (
                                                                    <li key={group} className="flex justify-between items-center bg-slate-700/50 px-3 py-1 rounded-md">
                                                                        <span className="font-semibold text-slate-400">{group}</span>
                                                                        <span className="font-bold text-white">{groupTotal.toLocaleString()} lbs</span>
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        ) : (
                                                            <p className="text-slate-500 text-center text-sm">No breakdown available for this session.</p>
                                                        )}
                                                        <div className="mt-4 flex justify-center">
                                                            <button onClick={() => handleDeleteSession(session.dateKey)} className="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-md transition-colors duration-300 shadow-md">Delete session</button>
                                                        </div>
                                                    </div>
                                                )}
                                            </li>
                                        ))}
                                        {totalSessions > visibleSessions && (
                                            <li className="text-center mt-4">
                                                <button onClick={handleLoadMore} className="text-white hover:underline">Load more sessions</button>
                                            </li>
                                        )}
                                    </ul>
                                )}
                            </div>
                        </div>

                        {/* Monthly Volume by Muscle Group */}
                        <div className="pb-20">
                            <h2 className="text-2xl font-bold text-white mb-4 text-center">Muscle volume</h2>
                            <div className="bg-slate-800 rounded-xl p-6 shadow-lg border border-slate-700">
                                <div className="flex justify-between items-center mb-4">
                                    <p className="text-sm text-slate-400">{dateRangeText}</p>
                                    <select value={timePeriod} onChange={(e) => setTimePeriod(e.target.value)} className="bg-slate-700 text-white rounded-md p-2 text-sm focus:ring-2 focus:ring-cyan-500 focus:outline-none">
                                        <option value="7-days">Last 7 days</option>
                                        <option value="this-month">This month</option>
                                        <option value="last-month">Last month</option>
                                        <option value="this-year">This year</option>
                                    </select>
                                </div>
                                {filteredMuscleGroupData.length > 0 ? (
                                    <table className="w-full text-left">
                                        <thead className="border-b border-slate-600">
                                            <tr>
                                                <th className="pb-2 font-semibold text-slate-300">Muscle Group</th>
                                                <th className="pb-2 font-semibold text-slate-300 text-right">Total Volume</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-700">
                                            {filteredMuscleGroupData.map(item => (
                                                <tr key={item.name}>
                                                    <td className="py-2 text-slate-400">{item.name}</td>
                                                    <td className="py-2 font-bold text-white text-right">{item.volume.toLocaleString()} lbs</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                ) : (
                                    <p className="text-slate-400 text-center">No data to display for this period.</p>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Fixed bottom button */}
                    <div className="fixed-bottom-button-container max-w-4xl mx-auto">
                        <button onClick={() => setIsAddSetModalOpen(true)} className="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-md transition duration-300 shadow-md hover:shadow-lg">
                            Add new sets
                        </button>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
